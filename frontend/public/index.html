<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EduTech</title>
  <link rel="stylesheet" href="index.css" />
</head>
<body>
  <div class="content">

    <h1>EXERCÍCIOS</h1>

    <input type="text" id="campo-pesquisa" placeholder="Digite o título do exercício" />
    <button onclick="window.location.href='novoExercicio.html'">Novo Exercício</button>
    <button onclick="pesquisarExercicio()">Pesquisar 🔍</button>

    <ul id="lista-exercicios"></ul>

    <!-- Sidebar lateral -->
    <div id="sidebar">
      <button class="close-btn" onclick="fecharSidebar()">×</button>
      <div id="detalhes-exercicio"></div>
    </div>

  </div>

  <script>
    const lista = document.getElementById('lista-exercicios');
    const sidebar = document.getElementById('sidebar');
    const detalhesDiv = document.getElementById('detalhes-exercicio');

    function carregarExercicios() {
      fetch('http://localhost:3000/exercicios')
        .then(res => res.json())
        .then(data => exibirLista(data))
        .catch(err => console.error('Erro ao buscar exercícios:', err));
    }

    function exibirLista(data) {
      lista.innerHTML = '';
      data.forEach(exercicio => {
        const item = document.createElement('li');
        item.innerHTML = `
          <button onclick="verExercicio(${exercicio.id})">${exercicio.titulo}</button>
          <div class="botoes">
            <button onclick="editarExercicio(${exercicio.id})">🖊️</button>
            <button onclick="excluirExercicio(${exercicio.id})">🗑️</button>
          </div>
        `;
        lista.appendChild(item);
      });
    }

    function pesquisarExercicio() {
      const termo = document.getElementById('campo-pesquisa').value.toLowerCase();
      fetch('http://localhost:3000/exercicios')
        .then(res => res.json())
        .then(data => {
          const filtrados = data.filter(ex => ex.titulo.toLowerCase().includes(termo));
          exibirLista(filtrados);
        })
        .catch(err => console.error('Erro ao pesquisar:', err));
    }

    function excluirExercicio(id) {
      fetch(`http://localhost:3000/exercicios/${id}`, { method: 'DELETE' })
        .then(res => res.json())
        .then(() => {
          alert('Exercício excluído!');
          carregarExercicios();
        })
        .catch(err => console.error('Erro ao excluir:', err));
    }

    function verExercicio(id) {
      fetch(`http://localhost:3000/exercicios/${id}`)
        .then(res => res.json())
        .then(exercicio => {
          detalhesDiv.innerHTML = `
            <h2>${exercicio.titulo}</h2>
            <p><strong>Descrição:</strong> ${exercicio.descricao}</p>
             <img src="./images/mapa.jpeg">
              <p><strong>Nível:</strong> ${exercicio.nivelDificuldade}</p>
              <p><strong>Alternativas:</strong> ${exercicio.alternativas.join(', ')}</p>
          `;
          abrirSidebar();
        })
        .catch(err => console.error('Erro ao exibir exercício:', err));
    }

    function abrirSidebar() {
      sidebar.classList.add('open');
    }

    function fecharSidebar() {
      sidebar.classList.remove('open');
    }

    carregarExercicios();
  </script>
</body>
</html>